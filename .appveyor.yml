environment:
  INTELOCLSDKROOT: C:\Intel\OpenCL\sdk
  matrix:
  - BOOST_ROOT: C:\Libraries\boost_1_58_0
    GENERATOR: Visual Studio 12 2013 Win64
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2013
  - BOOST_ROOT: C:\Libraries\boost_1_67_0
    GENERATOR: Visual Studio 14 2015 Win64
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
  - BOOST_ROOT: C:\Libraries\boost_1_67_0
    GENERATOR: Visual Studio 15 2017 Win64
    APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

clone_folder: C:\vexcl

before_build:
  - appveyor DownloadFile "http://registrationcenter-download.intel.com/akdlm/irc_nas/12512/opencl_runtime_16.1.2_x64_setup.msi"
  - start /wait msiexec /i opencl_runtime_16.1.2_x64_setup.msi /qn
  - appveyor DownloadFile "http://registrationcenter-download.intel.com/akdlm/irc_nas/vcp/12527/intel_sdk_for_opencl_2017_7.0.0.2567.exe"
  - start /wait .\intel_sdk_for_opencl_2017_7.0.0.2567.exe install --output=output.log --eula=accept
  - type output.log
build_script:
  - mkdir build && cd build
  - cmake .. -G"%GENERATOR%" -DVEXCL_BUILD_EXAMPLES=ON -DVEXCL_BUILD_TESTS=ON -DOpenCL_INCLUDE_DIR="%OPENCL_INCLUDE_DIR%"
  - cmake --build . --config Release
test_script:
  - ctest -C Release --output-on-failure
